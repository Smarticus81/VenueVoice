<!DOCTYPE html>
<html>
<head>
    <title>Audio Device Check</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .device { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .audio-input { background-color: #e8f5e8; }
        .audio-output { background-color: #f5f5e8; }
        .video-input { background-color: #e8e8f5; }
        .error { color: red; background-color: #ffe8e8; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { color: green; background-color: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Audio Device Detection Test</h1>
    <div id="status">Checking devices...</div>
    <div id="devices"></div>
    <div id="test-section" style="display:none;">
        <h2>Microphone Test</h2>
        <button id="test-mic">Test Microphone Access</button>
        <div id="mic-result"></div>
    </div>

    <script>
        async function checkDevices() {
            const statusDiv = document.getElementById('status');
            const devicesDiv = document.getElementById('devices');
            const testSection = document.getElementById('test-section');
            
            try {
                console.log('Enumerating devices...');
                const devices = await navigator.mediaDevices.enumerateDevices();
                
                let audioInputCount = 0;
                let audioOutputCount = 0;
                let videoInputCount = 0;
                
                devicesDiv.innerHTML = '';
                
                devices.forEach((device, index) => {
                    const deviceDiv = document.createElement('div');
                    deviceDiv.className = 'device';
                    
                    let typeClass = '';
                    switch(device.kind) {
                        case 'audioinput':
                            audioInputCount++;
                            typeClass = 'audio-input';
                            break;
                        case 'audiooutput':
                            audioOutputCount++;
                            typeClass = 'audio-output';
                            break;
                        case 'videoinput':
                            videoInputCount++;
                            typeClass = 'video-input';
                            break;
                    }
                    
                    deviceDiv.classList.add(typeClass);
                    deviceDiv.innerHTML = `
                        <strong>Device ${index + 1}:</strong><br>
                        Type: ${device.kind}<br>
                        Label: ${device.label || 'Unknown'}<br>
                        ID: ${device.deviceId}
                    `;
                    
                    devicesDiv.appendChild(deviceDiv);
                });
                
                if (audioInputCount === 0) {
                    statusDiv.innerHTML = '<div class="error">❌ No microphones found! This is why you\'re getting NotFoundError.</div>';
                } else {
                    statusDiv.innerHTML = `<div class="success">✅ Found ${audioInputCount} microphone(s), ${audioOutputCount} speaker(s), ${videoInputCount} camera(s)</div>`;
                    testSection.style.display = 'block';
                }
                
                console.log('Available devices:', devices);
                
            } catch (error) {
                console.error('Error enumerating devices:', error);
                statusDiv.innerHTML = `<div class="error">Error checking devices: ${error.message}</div>`;
            }
        }
        
        async function testMicrophone() {
            const resultDiv = document.getElementById('mic-result');
            resultDiv.innerHTML = 'Testing microphone access...';
            
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                resultDiv.innerHTML = '<div class="success">✅ Microphone access successful!</div>';
                
                // Stop the stream
                stream.getTracks().forEach(track => track.stop());
                
            } catch (error) {
                console.error('Microphone test error:', error);
                resultDiv.innerHTML = `<div class="error">❌ Microphone test failed: ${error.name} - ${error.message}</div>`;
            }
        }
        
        // Check devices on load
        checkDevices();
        
        // Set up microphone test button
        document.getElementById('test-mic').addEventListener('click', testMicrophone);
    </script>
</body>
</html>
